<%= form_with(model: survey, local: true) do |form| %>
  <% if survey.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(survey.errors.count, "error") %> prohibited this survey from being saved:</h2>

      <ul>
        <% survey.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="field" data-controller="activity">
    <label>
      <%= form.check_box 'response[work][outside]', data: { action: "activity#outsideChange", target: "activity.outside"} %>
      I work or attend school outside my home
    </label>
    <div class="field details" data-target="activity.outsideDetails" style="display:none;">
      <label>
        <%= form.check_box 'response[work][mask]'%>
        I wear a mask 100% of the time
      </label>
      <%= form.text_field 'response[work][comment]', placeholder: 'optionally share more details here' %>
    </div>
  </div>

  <div class="field" data-controller="activity">
    <label>
      <%= form.check_box 'response[shop][outside]', data: { action: "activity#outsideChange", target: "activity.outside"} %>
      I shop inside at the grocery or other stores
    </label>
    <div class="field details" data-target="activity.outsideDetails" style="display:none;">
      <label>
        <%= form.check_box 'response[shop][mask]'%>
        <input type="checkbox" value="mask" name="mask"> I wear a mask 100% of the time
      </label>
      <%= form.text_field 'response[shop][comment]', placeholder: 'optionally share more details here' %>
    </div>
  </div>

  <div class="field" data-controller="activity">
    <label>
      <%= form.check_box 'response[eat][outside]', data: { action: "activity#outsideChange", target: "activity.outside"} %>
      I eat at restauraunts
    </label>
    <div class="field details" data-target="activity.outsideDetails" style="display:none;">
      <label>
        <%= form.check_box 'response[eat][mask]'%>
        I wear a mask when away from my table
      </label>
      <%= form.text_field 'response[eat][comment]', placeholder: 'optionally share more details here' %>
    </div>
  </div>


  <div class="field" data-controller="occupants">
    <label>How many people do you live with?</label>
    <input type="number" min="0" max="20" value="0" id="occupants-number" data-target="occupants.number" data-action="occupants#updateNumber">
    <input type="range" min="0" max="10" value="0" id="occupants-slider" data-target="occupants.slider" data-action="input->occupants#slide">
  </div>

  <ol id="housemates">
  </ol>

  <div class="field">
    <label>Any other testing, travel, activities or special considerations for your household?</label>
    <textarea name="name" rows="3" cols="80"></textarea>
  </div>

  <div class="actions">
    <%= form.submit 'Save and Share' %>
  </div>


<%
  # hack to render household fields outside of form element
  # otherwise template fields will get submitted with the form
  @fform = form

  # end form
  end
%>

<!-- keep outside form so it blank fields don't get submitted -->
<template id="housemateTemplate">
  <li class="housemate">
    activites outside the home:
    <div class="details" style="margin:0;margin-bottom:1em;">
      <label>
        <%= @fform.check_box 'body[housemates][][work_school]'%> work or school
      </label>
      <label>
        <%= @fform.check_box 'body[housemates][][shop_eat]'%> shopping or eating out
      </label>
      <%= @fform.text_field 'body[housemates][][comment]', placeholder: 'more details on this person' %>
    </div>
  </li>
</template>
